<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="OO7"><meta name="keywords" content="rust, rustlang, rust-lang, oo7"><title>oo7 - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><script defer src="../main.js"></script>
    <noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../oo7/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../oo7/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Crate oo7</a></h2><div class="sidebar-elems"><div class="block"><ul><li class="version">Version 0.1.0-alpha.3</li><li><a id="all-types" href="all.html">All Items</a></li></div></ul><section><div class="block"><ul><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li><li><a href="#types">Type Definitions</a></li></ul></div></section><div id="sidebar-vars" data-name="oo7" data-ty="mod" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../oo7/index.html"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><div id="settings-menu" tabindex="-1">
                                <a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div>
                        </div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">oo7</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../src/oo7/lib.rs.html#1-27">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="oo7"><a href="#oo7">OO7</a></h2>
<p><a href="https://docs.rs/oo7/"><img src="https://docs.rs/oo7/badge.svg" alt="docs" /></a> <a href="https://crates.io/crates/oo7"><img src="https://img.shields.io/crates/v/oo7" alt="crates.io" /></a> <img src="https://github.com/bilelmoussaoui/oo7/workflows/CI/badge.svg" alt="CI" /></p>
<p>James Bond went on a new mission and this time as a <a href="https://specifications.freedesktop.org/secret-service/latest/">Secret Service provider</a>.</p>
<p>The library consists of two modules:</p>
<ul>
<li>
<p>An implementation of the Secret Service specifications using <a href="https://lib.rs/zbus">zbus</a>. Which sends the secrets to a DBus implementation of the <code>org.freedesktop.Secrets</code> interface that stores them somewhere safe.</p>
</li>
<li>
<p>A file backend using the <code>org.freedesktop.portal.Secrets</code> portal to retrieve the service’s key to encrypt the file with.
The file format is compatible with <a href="https://gitlab.gnome.org/GNOME/libsecret/">libsecret</a>.</p>
</li>
</ul>
<p>Sandboxed applications should prefer using the file backend as it doesn’t expose the application secrets to other sandboxed applications if they can talk to the <code>org.freedesktop.Secrets</code> service.</p>
<p>The library provides helper methods to store and retrieve secrets and uses either the DBus interface or the file backend based on whether the application is sandboxed or not.</p>
<h3 id="goals"><a href="#goals">Goals</a></h3>
<ul>
<li>Async only API</li>
<li>Ease to use</li>
<li>Integration with the <a href="https://flatpak.github.io/xdg-desktop-portal/#gdbus-org.freedesktop.portal.Secret">Secret portal</a> if sandboxed</li>
<li>Provide API to migrate from host secrets to sandboxed ones</li>
</ul>
<h3 id="examples"><a href="#examples">Examples</a></h3><h4 id="basic-usage"><a href="#basic-usage">Basic usage</a></h4>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">std::collections::HashMap</span>;

<span class="kw">async</span> <span class="kw">fn</span> <span class="ident">run</span>() -&gt; <span class="ident">oo7::Result</span><span class="op">&lt;</span>()<span class="op">&gt;</span> {
    <span class="kw">let</span> <span class="ident">keyring</span> <span class="op">=</span> <span class="ident">oo7::Keyring::new</span>().<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="comment">// Store a secret</span>
    <span class="ident">keyring</span>.<span class="ident">create_item</span>(
        <span class="string">&quot;Item Label&quot;</span>,
        <span class="ident">HashMap::from</span>([(<span class="string">&quot;attribute&quot;</span>, <span class="string">&quot;attribute_value&quot;</span>)]),
        <span class="string">b&quot;secret&quot;</span>,
        <span class="bool-val">true</span>,
    ).<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="comment">// Find a stored secret</span>
    <span class="kw">let</span> <span class="ident">items</span> <span class="op">=</span> <span class="ident">keyring</span>
        .<span class="ident">search_items</span>(<span class="ident">HashMap::from</span>([(<span class="string">&quot;attribute&quot;</span>, <span class="string">&quot;attribute_value&quot;</span>)]))
        .<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="comment">// Delete a stored secret</span>
    <span class="ident">keyring</span>
        .<span class="ident">delete</span>(<span class="ident">HashMap::from</span>([(<span class="string">&quot;attribute&quot;</span>, <span class="string">&quot;attribute_value&quot;</span>)]))
        .<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="comment">// Unlock the collection if the Secret Service is used</span>
    <span class="ident">keyring</span>.<span class="ident">unlock</span>().<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="comment">// Lock the collection if the Secret Service is used</span>
    <span class="ident">keyring</span>.<span class="ident">lock</span>().<span class="kw">await</span><span class="question-mark">?</span>;
    <span class="prelude-val">Ok</span>(())
}</code></pre></div>
<p>If your application makes heavy usage of the keyring like a password manager. You could store an instance of the <code>Keyring</code> in a <code>OnceCell</code></p>

<div class='information'><div class='tooltip ignore'>ⓘ</div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore"><code><span class="kw">use</span> <span class="ident">once_cell::sync::OnceCell</span>;
<span class="kw">use</span> <span class="ident">std::collections::HashMap</span>;

<span class="kw">static</span> <span class="ident">KEYRING</span>: <span class="ident">OnceCell</span><span class="op">&lt;</span><span class="ident">oo7::Keyring</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">OnceCell::new</span>();

<span class="kw">fn</span> <span class="ident">main</span>() {
    <span class="comment">// SOME_RUNTIME could be a tokio/async-std/glib runtime</span>
    <span class="ident">SOME_RUNTIME</span>.<span class="ident">block_on</span>(<span class="kw">async</span> {
        <span class="kw">let</span> <span class="ident">keyring</span> <span class="op">=</span> <span class="ident">oo7::Keyring::new</span>()
            .<span class="kw">await</span>
            .<span class="ident">expect</span>(<span class="string">&quot;Failed to start Secret Service&quot;</span>);
        <span class="ident">KEYRING</span>.<span class="ident">set</span>(<span class="ident">keyring</span>);
    });

    <span class="comment">// Then to use it</span>
    <span class="ident">SOME_RUNTIME</span>.<span class="ident">spawn</span>(<span class="kw">async</span> {
        <span class="kw">let</span> <span class="ident">items</span> <span class="op">=</span> <span class="ident">KEYRING</span>
            .<span class="ident">get</span>()
            .<span class="ident">unwrap</span>()
            .<span class="ident">search_items</span>(<span class="ident">HashMap::from</span>([(<span class="string">&quot;attribute&quot;</span>, <span class="string">&quot;attribute_value&quot;</span>)]))
            .<span class="kw">await</span>;
    });
}</code></pre></div>
<h4 id="migrating-your-secrets-to-the-file-backend"><a href="#migrating-your-secrets-to-the-file-backend">Migrating your secrets to the file backend</a></h4>
<p>The library also comes with API to migrate your secrets from the host Secret Service to the sandboxed file backend. Note that the items are removed from the host keyring if they are migrated successfully.</p>

<div class='information'><div class='tooltip ignore'>ⓘ</div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore"><code><span class="kw">use</span> <span class="ident">std::collections::HashMap</span>;

<span class="comment">// SOME_RUNTIME could be a tokio/async-std/glib runtime</span>
<span class="ident">SOME_RUNTIME</span>.<span class="ident">block_on</span>(<span class="kw">async</span> {
    <span class="kw">match</span> <span class="ident">oo7::migrate</span>(<span class="macro">vec!</span>[<span class="ident">HashMap::from</span>([(<span class="string">&quot;attribute&quot;</span>, <span class="string">&quot;attribute_value&quot;</span>)])], <span class="bool-val">true</span>).<span class="kw">await</span> {
        <span class="prelude-val">Ok</span>(<span class="kw">_</span>) =&gt; {
            <span class="comment">// Store somewhere the migration happened, to avoid re-doing it at every startup</span>
        }
        <span class="prelude-val">Err</span>(<span class="ident">err</span>) =&gt; <span class="macro">log::error!</span>(<span class="string">&quot;Failed to migrate secrets {err}&quot;</span>),
    }
});</code></pre></div>
<h3 id="optional-features"><a href="#optional-features">Optional features</a></h3><div><table><thead><tr><th>Feature</th><th>Description</th><th>Default</th></tr></thead><tbody>
<tr><td><code>tracing</code></td><td>Record various debug information using the <code>tracing</code> library</td><td>No</td></tr>
<tr><td><code>async-std</code></td><td>Use <code>async-std</code> APIs for IO/filesystem operations</td><td>Yes</td></tr>
<tr><td><code>tokio_runtime</code></td><td>Use <code>tokio</code> APIs for IO/Filesystem operations</td><td>No</td></tr>
<tr><td><code>unstable</code></td><td>Unlock internal APIs</td><td>No</td></tr>
</tbody></table>
</div><h3 id="how-does-it-compare-to-other-libraries"><a href="#how-does-it-compare-to-other-libraries">How does it compare to other libraries?</a></h3>
<ul>
<li>
<p><a href="https://gitlab.gnome.org/World/Rust/libsecret-rs">libsecret-rs</a> provides Rust bindings of the C library <a href="https://gitlab.gnome.org/GNOME/libsecret/">libsecret</a>. The current main pain point with it is that
it does assume things for you so it will either use the host or the sandbox file-based keyring which makes migrating your secrets
to inside the sandbox a probably impossible task. There are also issues like <a href="https://gitlab.gnome.org/GNOME/libsecret/-/issues/58">https://gitlab.gnome.org/GNOME/libsecret/-/issues/58</a>
that makes it not usable inside the Flatpak sandbox.</p>
</li>
<li>
<p><a href="https://github.com/hwchen/secret-service-rs/">secret-service-rs</a> uses <a href="https://lib.rs/zbus">zbus</a> internally as well but does provide a sync only API, hasn’t seen an update in a while, doesn’t integrate with <a href="https://flatpak.github.io/xdg-desktop-portal/#gdbus-org.freedesktop.portal.Secret">Secret portal</a> if sandboxed.</p>
</li>
</ul>
<h2 id="license"><a href="#license">License</a></h2>
<p>The project is released under the MIT license.</p>
<h2 id="credits"><a href="#credits">Credits</a></h2>
<ul>
<li><a href="https://github.com/hwchen/secret-service-rs/">secret-service-rs</a> for the encrypted Secret Service implementation.</li>
</ul>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="dbus/index.html" title="oo7::dbus mod">dbus</a></div><div class="item-right docblock-short"><p>A <a href="https://specifications.freedesktop.org/secret-service/latest/index.html">Secret Service</a> implementation.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="portal/index.html" title="oo7::portal mod">portal</a></div><div class="item-right docblock-short"><p>File backend implementation backed by the <a href="https://flatpak.github.io/xdg-desktop-portal/#gdbus-org.freedesktop.portal.Secret">Secret portal</a>.</p>
</div></div></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Key.html" title="oo7::Key struct">Key</a></div><div class="item-right docblock-short"><p>A key.</p>
</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Error.html" title="oo7::Error enum">Error</a></div><div class="item-right docblock-short"><p>The error type for oo7.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Item.html" title="oo7::Item enum">Item</a></div><div class="item-right docblock-short"><p>A generic secret with a label and attributes.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Keyring.html" title="oo7::Keyring enum">Keyring</a></div><div class="item-right docblock-short"><p>A <a href="dbus/index.html">Secret Service</a> or <a href="portal/index.html">file</a> backed keyring
implementation.</p>
</div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.is_sandboxed.html" title="oo7::is_sandboxed fn">is_sandboxed</a></div><div class="item-right docblock-short"><p>Checks whether the application is sandboxed or not.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.migrate.html" title="oo7::migrate fn">migrate</a></div><div class="item-right docblock-short"><p>Helper to migrate your secrets from the host Secret Service
to the sandboxed file backend.</p>
</div></div></div><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.Result.html" title="oo7::Result type">Result</a></div><div class="item-right docblock-short"><p>Alias for <a href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="std::result::Result"><code>std::result::Result</code></a> with the error type <a href="enum.Error.html" title="Error"><code>Error</code></a>.</p>
</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="oo7" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.63.0-nightly (28b891916 2022-05-29)" ></div>
</body></html>